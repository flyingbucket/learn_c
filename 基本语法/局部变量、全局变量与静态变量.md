

## 局部变量

- **作用域**：
  - 局部变量的作用域仅限于它所在的函数、`if`、`for` 或 `while` 等代码块内部。在代码块外部无法访问该变量。
  - 例如，`for` 循环中声明的变量只在循环内部有效。

- **生存期**：
  - 局部变量的生存期从它们被声明时开始，直到代码块执行完毕为止。它们通常保存在栈上，因此当程序离开作用域时，局部变量会被销毁。

  示例：
```c
void func() {
  int x = 10;  // 局部变量 x
  printf("%d\n", x);
}
// x 在 func 函数外部无法访问
```


在上面的代码中，`x` 仅在 `func()` 函数内部有效，退出函数后 `x` 被销毁。


## 全局变量


### 作用域和生存期

- **作用域**：
    
    - 全局变量的作用域是整个文件。如果在其他文件中需要访问该全局变量，可以使用 `extern` 关键字声明。
        
    - 全局变量在程序中只存在一份，可以在程序中的任何地方访问。
        
- **生存期**：
    
    - 全局变量的生存期是整个程序的生命周期，从程序开始到程序结束。它们通常保存在数据段中。
        
    
    示例：
    
    ```c
    int x = 10;  // 全局变量 x
    
    void func() {
        printf("%d\n", x);  // 访问全局变量 x
    }
    
    int main() {
        printf("%d\n", x);  // 访问全局变量 x
        func();
        return 0;
    }
    ```
    
在上述代码中，`x` 是全局变量，可以在 `main()` 和 `func()` 中访问，并且它的值会在程序执行期间一直存在。


### extern关键字

如果使用extern关键字导出全局变量，则在其他文件中也可以访问。

file1.c
```c
#include <stdio.h>

int x = 10;  // 全局变量 x

void print_x() {
    printf("x = %d\n", x);  // 访问全局变量 x
}

```

file2.c
```c
#include <stdio.h>

extern int x;  // 使用 extern 声明全局变量 x

void change_x() {
    x = 20;  // 修改全局变量 x
}

int main() {
    printf("Before change, x = %d\n", x);  // 访问全局变量 x
    change_x();  // 修改全局变量 x
    printf("After change, x = %d\n", x);  // 访问修改后的全局变量 x
    return 0;
}

```

file1.c中定义了全局变量 `x`,file2.c中使用 `extern int x;` 声明了 `x`，表示它在其他文件中已经定义。然后，`file2.c` 可以访问和修改 `x`。`extern`可以在任意文件的任意位置声明，编译器和连接器会自动在所有参与编译的源文件中寻找其定义。

对于上述两个源文件 `file1.c` 和 `file2.c`，可以使用以下命令进行编译和链接：

```
gcc file1.c file2.c -o program
```

运行程序时，输出将会是：

```
Before change, x = 10 
After change, x = 20
```

## 静态变量 (`static`)

- **局部静态变量**：
    
    - **作用域**：静态局部变量的作用域依然是局部的，只能在定义它的函数或代码块内部访问。
        
    - **生存期**：静态局部变量的生存期是整个程序的生命周期。即使函数退出，静态变量的值会被保留，在下一次调用该函数时，静态变量仍然保持之前的值。
        
    
    示例：
    
    ```c
    void func() {
        static int counter = 0;  // 静态局部变量 counter
        counter++;
        printf("%d\n", counter);
    }
    
    int main() {
        func();  // 输出 1
        func();  // 输出 2
        func();  // 输出 3
        return 0;
    }
    ```
    
    在上述代码中，`counter` 是静态局部变量，它的值只有在第一次调用func()时初始化，在后续每次调用 `func()` 时会跳过初始化，保持之前的值并累加。
    
- **全局静态变量**：
    
    - **作用域**：静态全局变量的作用域被限制在当前文件内，其他文件无法访问。它的作用类似于一个局部的全局变量。
        
    - **生存期**：静态全局变量的生存期是整个程序的生命周期。
        
    
    示例：
    
    ```c
    static int x = 10;  // 静态全局变量 x，作用域仅限于当前文件
    
    void func() {
        printf("%d\n", x);  // 访问静态全局变量 x
    }
    ```
    
    在该示例中，`x` 是静态全局变量，它的作用域仅限于当前文件，其他文件无法访问。
    

## 总结

- **局部变量**：作用域是代码块内，生存期仅在代码块执行期间。
    
- **全局变量**：作用域是整个文件，生存期是程序生命周期。
    
- **静态变量**：
    
    - **静态局部变量**：作用域是局部的，生存期是程序生命周期，跨函数调用保持值。
        
    - **静态全局变量**：作用域是当前文件，生存期是程序生命周期。
        
**注意**：局部声明的变量如果与外部作用域变量重名则会发生[[遮蔽(shadowing）]]